<html><head>
    <meta charset="utf-8"/>
    <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
    <link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <title>Stitch Design</title>
    <link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style type="text/tailwindcss">
        :root {
          --primary-color: #0b80ee;
          --secondary-color: #f0f2f5;
          --text-primary: #111518;
          --text-secondary: #60768a;
          --border-color: #dbe1e6;
        }
        body {
          font-family: Inter, "Noto Sans", sans-serif;
        }
        .sidebar-item:hover {
          background-color: var(--secondary-color);
        }
        .sidebar-item.active {
          background-color: var(--secondary-color);
        }
        .dropdown:hover .dropdown-menu {
          display: block;
        }
        .dropdown-menu.show {
            display: block;
        }
        /* Styles for closed sidebar */
        .sidebar-closed {
            width: 0 !important;
            padding-left: 0 !important;
            padding-right: 0 !important;
            border-right-width: 0 !important;
            overflow: hidden !important; /* Ensure overflow is hidden */
        }
        /* Hide direct children of .sidebar-closed, EXCEPT for #sidebar-top-panel */
        .sidebar-closed > *:not(#sidebar-top-panel) {
            display: none !important;
        }
        /* Specific styles for #sidebar-top-panel when sidebar is closed */
        .sidebar-closed > #sidebar-top-panel {
            padding: 0.25rem !important; /* Minimal padding around the button */
            border-bottom-width: 0 !important; /* Hide border if any */
        }
        /* Hide the H1 title within the top panel when sidebar is closed */
        .sidebar-closed > #sidebar-top-panel h1 {
            display: none !important;
        }
        /* Ensure the toggle button within the top panel is visible and centered */
        .sidebar-closed > #sidebar-top-panel #toggle-sidebar {
            display: flex !important; 
            justify-content: center;
            align-items: center;
            margin: 0 !important; /* Remove any margins */ 
            padding: 0.25rem !important; /* Consistent padding */
            width: auto; /* Allow button to size to its icon */
        }
        /* Ensure the icon inside the toggle button is visible */
        .sidebar-closed > #sidebar-top-panel #toggle-sidebar > .material-icons-outlined {
            display: inline-block !important;
        }
      </style>
    </head>
    <body>
    <div class="relative flex size-full min-h-screen flex-col bg-white group/design-root overflow-x-hidden">
    <div id="header-placeholder"></div>
    <div class="flex h-full grow">
    <aside class="w-80 bg-slate-50 border-r border-[var(--border-color)] flex flex-col transition-all duration-300 ease-in-out shrink-0 max-h-[calc(100vh-4rem)] md:sticky md:top-16">
    <div class="p-4 border-b border-[var(--border-color)]" id="sidebar-top-panel">
    <div class="flex items-center justify-between">
    <h1 class="text-[var(--text-primary)] text-xl font-semibold">Chatbot</h1>
    <button class="p-1 rounded-md hover:bg-[var(--secondary-color)] text-[var(--text-secondary)]" id="toggle-sidebar">
    <span class="material-icons-outlined">menu_open</span>
    </button>
    </div>
    </div>
    <div class="flex flex-col gap-2 p-4 overflow-y-auto flex-grow">
    <button class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-[var(--text-primary)] hover:bg-[var(--secondary-color)] transition-colors duration-150">
    <span class="material-icons text-[var(--primary-color)]">add_circle</span>
    <p class="text-sm font-medium">New chat</p>
    </button>
    <div class="flex items-center justify-between mt-4 mb-1 px-3">
    <h2 class="text-xs text-[var(--text-secondary)] font-semibold uppercase">Recent Chats</h2>
    <div class="relative">
    <button class="p-1 rounded-md hover:bg-slate-200 text-[var(--text-secondary)]" id="sort-button">
    <span class="material-icons-outlined text-base">sort</span>
    </button>
    <ul class="absolute hidden right-0 mt-1 w-40 bg-white border border-[var(--border-color)] rounded-md shadow-lg z-10" id="sort-menu">
    <li><a class="block px-3 py-1.5 text-sm text-[var(--text-primary)] hover:bg-[var(--secondary-color)]" data-sort="recent" href="#">최신순</a></li>
    <li><a class="block px-3 py-1.5 text-sm text-[var(--text-primary)] hover:bg-[var(--secondary-color)]" data-sort="oldest" href="#">오래된순</a></li>
    <li><a class="block px-3 py-1.5 text-sm text-[var(--text-primary)] hover:bg-[var(--secondary-color)]" data-sort="name_asc" href="#">이름 오름차순</a></li>
    <li><a class="block px-3 py-1.5 text-sm text-[var(--text-primary)] hover:bg-[var(--secondary-color)]" data-sort="name_desc" href="#">이름 내림차순</a></li>
    </ul>
    </div>
    </div>
    <a class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-[var(--text-primary)] hover:bg-[var(--secondary-color)] transition-colors duration-150" href="#">
    <span class="material-icons-outlined text-blue-500">code</span>
    <p class="text-sm font-medium">코딩 세션</p>
    </a>
    <a class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-[var(--text-primary)] active bg-[var(--secondary-color)] transition-colors duration-150" href="#">
    <span class="material-icons-outlined text-green-500">analytics</span>
    <p class="text-sm font-medium">분석 세션</p>
    </a>
    <a class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-[var(--text-primary)] hover:bg-[var(--secondary-color)] transition-colors duration-150" href="#">
    <span class="material-icons-outlined text-purple-500">description</span>
    <p class="text-sm font-medium">문서 세션</p>
    </a>
    <a class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-[var(--text-primary)] hover:bg-[var(--secondary-color)] transition-colors duration-150" href="#">
    <span class="material-icons-outlined text-orange-500">model_training</span>
    <p class="text-sm font-medium">예측 세션</p>
    </a>
    <a class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-[var(--text-primary)] hover:bg-[var(--secondary-color)] transition-colors duration-150" href="#">
    <span class="material-icons-outlined text-gray-500">smart_toy</span>
    <p class="text-sm font-medium">Auto 세션</p>
    </a>
    </div>
    <div class="p-4 border-t border-[var(--border-color)]">
    <a class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-[var(--text-primary)] hover:bg-[var(--secondary-color)] transition-colors duration-150" href="#">
    <span class="material-icons-outlined text-[var(--text-secondary)]">help_outline</span>
    <p class="text-sm font-medium">FAQ</p>
    </a>
    <a class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-[var(--text-primary)] hover:bg-[var(--secondary-color)] transition-colors duration-150" href="{% url 'accounts:settings' %}">
    <span class="material-icons-outlined text-[var(--text-secondary)]">settings</span>
    <p class="text-sm font-medium">Settings</p>
    </a>
    </div>
    </aside>
    <main class="flex flex-1 flex-col bg-white max-h-[calc(100vh-4rem)]">
    <div class="flex-grow flex flex-col items-center p-6 pb-0 overflow-y-auto">
    <div class="flex-grow flex flex-col items-center px-6 overflow-y-auto w-full">
    <div class="w-full max-w-3xl flex flex-col justify-end flex-grow">
    <div class="flex mb-2">
    <div class="bg-[var(--secondary-color)] p-3 rounded-lg max-w-[70%]">
    <p class="text-[var(--text-primary)] text-sm">안녕하세요! 무엇을 도와드릴까요?</p>
    </div>
    </div>
    <div class="flex items-center gap-2 self-start mb-4">
    <button class="p-1.5 rounded-md hover:bg-gray-200 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors">
    <span class="material-icons-outlined text-sm">content_copy</span>
    </button>
    <button class="p-1.5 rounded-md hover:bg-gray-200 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors">
    <span class="material-icons-outlined text-sm">thumb_up</span>
    </button>
    <button class="p-1.5 rounded-md hover:bg-gray-200 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors">
    <span class="material-icons-outlined text-sm">thumb_down</span>
    </button>
    </div>
    <div class="flex justify-end mb-4">
    <div class="bg-[var(--primary-color)] text-white p-3 rounded-lg max-w-[70%]">
    <p class="text-sm">오늘 날씨 어때?</p>
    </div>
    </div>
    <div class="text-center mb-12 mt-auto pt-12">
    <span class="material-icons text-6xl text-[var(--primary-color)] mb-4">smart_toy</span>
    <h2 class="text-[var(--text-primary)] tracking-light text-3xl font-bold leading-tight">How can I help you today?</h2>
    </div>
    </div>
    </div>
    </div>
    <div class="sticky bottom-0 bg-white/80 backdrop-blur-md border-t border-[var(--border-color)] p-4 md:p-6">
    <div class="max-w-3xl mx-auto">
    <div class="relative flex items-end gap-2">
    <div class="dropdown relative">
    <button class="bg-white text-[var(--text-secondary)] hover:text-[var(--text-primary)] font-medium p-2.5 rounded-lg border border-[var(--border-color)] hover:border-[var(--primary-color)] focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] flex items-center justify-center size-11">
    <span class="material-icons-outlined text-gray-500 text-xl">smart_toy</span>
    </button>
    <ul class="dropdown-menu absolute hidden text-[var(--text-primary)] pt-1 min-w-[180px] bg-white border border-[var(--border-color)] rounded-lg shadow-lg z-10 bottom-full mb-2">
    <li><a class="rounded-t-lg hover:bg-[var(--secondary-color)] py-2 px-4 block whitespace-no-wrap flex items-center gap-2 text-sm" href="#"><span class="material-icons-outlined text-blue-500">code</span> 코딩 세션</a></li>
    <li><a class="hover:bg-[var(--secondary-color)] py-2 px-4 block whitespace-no-wrap flex items-center gap-2 text-sm" href="#"><span class="material-icons-outlined text-green-500">analytics</span> 분석 세션</a></li>
    <li><a class="hover:bg-[var(--secondary-color)] py-2 px-4 block whitespace-no-wrap flex items-center gap-2 text-sm" href="#"><span class="material-icons-outlined text-purple-500">description</span> 문서 세션</a></li>
    <li><a class="hover:bg-[var(--secondary-color)] py-2 px-4 block whitespace-no-wrap flex items-center gap-2 text-sm" href="#"><span class="material-icons-outlined text-orange-500">model_training</span> 예측 세션</a></li>
    <li><a class="rounded-b-lg hover:bg-[var(--secondary-color)] py-2 px-4 block whitespace-no-wrap flex items-center gap-2 text-sm" href="#"><span class="material-icons-outlined text-gray-500">smart_toy</span> Auto 세션</a></li>
    </ul>
    </div>
    <textarea class="form-input flex-1 resize-none overflow-hidden rounded-xl text-[var(--text-primary)] focus:outline-0 focus:ring-2 focus:ring-[var(--primary-color)] border border-[var(--border-color)] bg-white focus:border-[var(--primary-color)] min-h-12 max-h-48 placeholder:text-[var(--text-secondary)] p-3 pr-20 text-sm font-normal leading-normal" placeholder="Type your message here..." rows="1" style="padding-right: 5.5rem;"></textarea>
    <div class="absolute right-2 bottom-2 flex items-center gap-2">
    <button aria-label="Attach file" class="flex items-center justify-center size-9 rounded-lg hover:bg-[var(--secondary-color)] text-[var(--text-secondary)] hover:text-[var(--primary-color)] transition-colors duration-150">
    <span class="material-icons-outlined text-xl">attach_file</span>
    </button>
    <button aria-label="Send message" class="flex items-center justify-center size-9 rounded-lg bg-[var(--primary-color)] text-white hover:bg-opacity-90 transition-colors duration-150">
    <span class="material-icons text-xl">send</span>
    </button>
    </div>
    </div>
    <p class="text-xs text-[var(--text-secondary)] text-center mt-2">Chatbot may produce inaccurate information.</p>
    </div>
    </div>
    </main>
    </div>
    </div>
    <script>
        const toggleSidebarButton = document.getElementById('toggle-sidebar');
        const openSidebarMobileButton = document.getElementById('open-sidebar-mobile'); // Kept for loadHeader logic
        const sidebar = document.querySelector('aside');

        function toggleSidebar() {
            const isCurrentlyClosed = sidebar.classList.contains('sidebar-closed');
            const toggleIcon = toggleSidebarButton.querySelector('.material-icons-outlined');

            if (isCurrentlyClosed) { // Action: OPEN sidebar
                sidebar.classList.remove('sidebar-closed');
                if (toggleIcon) toggleIcon.textContent = 'menu_open';
                
                if (window.innerWidth < 768) {
                    // Mobile: Apply overlay and specific layout for open mobile sidebar
                    sidebar.classList.add('absolute', 'z-20', 'bg-slate-50', 'h-full', 'max-h-full', 'top-0');
                    sidebar.classList.remove('max-h-[calc(100vh-4rem)]', 'md:sticky', 'md:top-16');
                    
                    const overlay = document.createElement('div');
                    overlay.classList.add('fixed', 'inset-0', 'bg-black/30', 'z-10', 'md:hidden');
                    overlay.id = 'sidebar-overlay';
                    document.body.appendChild(overlay);
                    overlay.addEventListener('click', () => {
                        toggleSidebar(); // This will call close logic
                        overlay.remove();
                    });
                }
            } else { // Action: CLOSE sidebar
                sidebar.classList.add('sidebar-closed');
                if (toggleIcon) toggleIcon.textContent = 'menu';
                
                if (window.innerWidth < 768) {
                    // Mobile: Remove overlay and restore default/desktop-like layout classes before hiding
                    const overlay = document.getElementById('sidebar-overlay');
                    if (overlay) overlay.remove();
                    
                    sidebar.classList.remove('absolute', 'z-20', 'bg-slate-50', 'h-full', 'max-h-full', 'top-0');
                    sidebar.classList.add('max-h-[calc(100vh-4rem)]', 'md:sticky', 'md:top-16');
                }
            }
        }

        if (toggleSidebarButton) {
            toggleSidebarButton.addEventListener('click', toggleSidebar);
        }

        const textarea = document.querySelector('textarea');
        if (textarea) {
            textarea.addEventListener('input', () => {
              textarea.style.height = 'auto';
              textarea.style.height = textarea.scrollHeight + 'px';
            });
        }

        // Initial sidebar state on page load for mobile
        if (window.innerWidth < 768) {
          if (!sidebar.classList.contains('sidebar-closed')) {
            // If not already closed by default (e.g. via HTML class), close it
            toggleSidebar(); 
          }
        } else {
            // Ensure sidebar is not closed by default on desktop if it was previously left in mobile closed state
            // And also ensure the icon is correct if it starts open
            if (sidebar.classList.contains('sidebar-closed')) {
                // If it has sidebar-closed, remove it for desktop initial view
                // sidebar.classList.remove('sidebar-closed'); 
                // Decided against auto-opening on desktop load if class is present.
                // Instead, ensure icon is correct if it IS closed.
                const toggleIcon = toggleSidebarButton.querySelector('.material-icons-outlined');
                if (toggleIcon) toggleIcon.textContent = 'menu';
            } else {
                const toggleIcon = toggleSidebarButton.querySelector('.material-icons-outlined');
                if (toggleIcon) toggleIcon.textContent = 'menu_open';
            }
        }

        // Dropdown logic
        const dropdownButton = document.querySelector('.dropdown button');
        const dropdownMenu = document.querySelector('.dropdown-menu');
        if (dropdownButton && dropdownMenu) {
            const dropdownItems = dropdownMenu.querySelectorAll('a');
            const selectedSessionIcon = dropdownButton.querySelector('span.material-icons-outlined');
            
            dropdownItems.forEach(item => {
              item.addEventListener('click', function(e) {
                e.preventDefault();
                const icon = this.querySelector('.material-icons-outlined');
                if (selectedSessionIcon && icon) {
                    selectedSessionIcon.textContent = icon.textContent;
                    selectedSessionIcon.className = icon.className + ' text-xl'; 
                }
                dropdownMenu.classList.add('hidden');
              });
            });
            
            document.addEventListener('click', function(event) {
              if (!dropdownButton.contains(event.target) && !dropdownMenu.contains(event.target)) {
                dropdownMenu.classList.add('hidden');
              }
            });
            
            dropdownButton.addEventListener('click', () => {
                dropdownMenu.classList.toggle('hidden');
            });
        }

        // Sort button logic
        const sortButton = document.getElementById('sort-button');
        const sortMenu = document.getElementById('sort-menu');
        if (sortButton && sortMenu) {
            sortButton.addEventListener('click', (event) => {
                event.stopPropagation();
                sortMenu.classList.toggle('hidden');
            });
            document.addEventListener('click', (event) => {
                if (!sortMenu.contains(event.target) && !sortButton.contains(event.target)) {
                    sortMenu.classList.add('hidden');
                }
            });
            sortMenu.querySelectorAll('a').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Sort by:', e.target.dataset.sort);
                    sortMenu.classList.add('hidden');
                });
            });
        }
    </script>
    <script>
        function loadHeader() {
            fetch('/_header.html') // Adjusted path for templates in subdirectories
                .then(response => response.text())
                .then(data => {
                    document.getElementById('header-placeholder').innerHTML = data;
                    // Set active link
                    const currentPage = window.location.pathname.split('/').pop().replace('.html', '');
                    const navLink = document.querySelector(`nav a[data-navlink='${currentPage || 'chatbot'}']`);
                    if (navLink) {
                        navLink.classList.add('text-[var(--text-primary)]', 'bg-[var(--secondary-color)]');
                        navLink.classList.remove('text-[var(--text-secondary)]');
                    }

                    // Re-attach event listener for mobile sidebar toggle if it's defined in this page's main script
                    const openSidebarMobileButton = document.getElementById('open-sidebar-mobile');
                    if (typeof openMobileSidebar === 'function' && openSidebarMobileButton) { // Check if openMobileSidebar is defined
                         openSidebarMobileButton.addEventListener('click', openMobileSidebar);
                    } else if (typeof toggleSidebar === 'function' && openSidebarMobileButton) {
                        // When on a page with toggleSidebar (like chatbot.html), make the header's mobile toggle button use it.
                        openSidebarMobileButton.addEventListener('click', toggleSidebar);
                    }
                })
                .catch(error => console.error('Error loading header:', error));
        }
        document.addEventListener('DOMContentLoaded', loadHeader);
    </script>
    </body></html>
