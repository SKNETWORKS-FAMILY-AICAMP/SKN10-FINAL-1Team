<html><head>
  <meta charset="utf-8"/>
  <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
  <link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
  <title>Stitch Design</title>
  <link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <style type="text/tailwindcss">
        :root {
          --primary-color: #0b80ee;
          --secondary-color: #f0f2f5;
          --text-primary: #111518;
          --text-secondary: #60768a;
          --background-color: #ffffff;
        }
        body {
          font-family: Inter, "Noto Sans", sans-serif;
        }
      </style>
  </head>
  <body class="bg-[var(--background-color)] text-[var(--text-primary)]">
  <div class="relative flex size-full min-h-screen flex-col group/design-root overflow-x-hidden">
  <div class="layout-container flex h-full grow flex-col">
  <div id="header-placeholder"></div>
  <main class="px-6 md:px-10 lg:px-40 flex flex-1 justify-center py-8">
  <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
  <div class="flex flex-wrap justify-between gap-4 p-4">
  <div class="flex flex-col gap-2">
  <h2 class="text-[var(--text-primary)] tracking-tight text-3xl font-bold leading-tight">Profile</h2>
  <p class="text-[var(--text-secondary)] text-base font-normal leading-normal">Manage your profile information and preferences.</p>
  </div>
  </div>
  <section class="p-4 @container">
  <div class="flex w-full flex-col gap-6 @[520px]:flex-row @[520px]:justify-between @[520px]:items-center border-b border-[var(--secondary-color)] pb-6 mb-6">
  <div class="flex items-center gap-4">
  <div class="relative w-32 h-32 group">
      <img id="profileImage" src="{% if user.profile_image %}{{ user.profile_image.url }}{% else %}https://via.placeholder.com/128{% endif %}" alt="Profile Image" class="w-full h-full rounded-full object-cover border-2 border-gray-200">
      <button class="absolute bottom-1 right-1 bg-[var(--primary-color)] text-white rounded-full p-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] focus:ring-offset-2">
          <span class="material-icons text-sm">edit</span>
      </button>
  </div>
  <div class="flex flex-col justify-center">
      {% if user.name %}
      <p class="text-[var(--text-primary)] text-2xl font-bold leading-tight tracking-[-0.015em]">{{ user.name }}</p>
      {% endif %}
      <p class="text-[var(--text-secondary)] text-base font-normal leading-normal">{{ user.email }}</p>
  </div>
  </div>
  </div>
  </section>
  <form id="profileForm" method="post" enctype="multipart/form-data" class="mt-8 space-y-6 px-4">
      {% csrf_token %}
  <div>
  <h3 class="text-[var(--text-primary)] text-xl font-semibold leading-tight tracking-[-0.015em] mb-4">Profile Information</h3>
  <div class="grid grid-cols-1 gap-6">
  <label class="flex flex-col">
  <p class="text-[var(--text-primary)] text-sm font-medium leading-normal pb-2">Nickname</p>
  <input class="form-input flex w-full max-w-md min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[var(--text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] border border-[#dbe1e6] bg-white focus:border-transparent h-12 placeholder:text-[var(--text-secondary)] p-3 text-base font-normal leading-normal transition-colors" placeholder="Enter your nickname" value="{{ user.name }}" name="name"/>
  </label>
  <div>
      <label for="profile_image" class="block text-sm font-medium text-gray-700">Upload new photo</label>
      <input type="file" name="profile_image" id="profile_image" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"/>
  </div>

  <div class="relative flex items-center">
      <div class="flex-grow border-t border-gray-300"></div>
      <span class="flex-shrink mx-4 text-gray-400 text-sm">OR</span>
      <div class="flex-grow border-t border-gray-300"></div>
  </div>

  <div>
      <label for="photo_url" class="block text-sm font-medium text-gray-700">Enter image URL</label>
      <input type="text" id="photo_url" name="photo_url" class="mt-1 w-full pl-3 pr-10 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="https://example.com/image.jpg">
  </div>
  </div>
  </div>
  <div class="flex pt-4 justify-end border-t border-[var(--secondary-color)]">
  <button class="flex min-w-[120px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-11 px-6 bg-[var(--primary-color)] text-white text-base font-semibold leading-normal tracking-[0.015em] hover:bg-opacity-90 transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] focus:ring-offset-2" type="submit">
  <span class="truncate">Save Changes</span>
  </button>
  </div>
  </form>
  </div>
  </main>
  </div>
  </div>
  
  <script>
      document.addEventListener('DOMContentLoaded', function () {
          // Function to load the header
          function loadHeader() {
              fetch('/_header.html')
                  .then(response => response.text())
                  .then(data => {
                      document.getElementById('header-placeholder').innerHTML = data;
                      const mobileSidebarToggle = document.getElementById('open-sidebar-mobile');
                      if (mobileSidebarToggle) {
                          mobileSidebarToggle.style.display = 'none';
                      }
                      // Set active link for profile page
                      const navLink = document.querySelector(`nav a[data-navlink='profile']`);
                      if (navLink) {
                          navLink.classList.add('text-[var(--text-primary)]', 'bg-[var(--secondary-color)]');
                          navLink.classList.remove('text-[var(--text-secondary)]');
                      }
                  })
                  .catch(error => console.error('Error loading header:', error));
          }

          // Load the header
          loadHeader();

          // Handle profile form submission with AJAX
          const profileForm = document.getElementById('profileForm');
          if (profileForm) {
              profileForm.addEventListener('submit', function (event) {
                  event.preventDefault(); // Prevent default page reload

                  const formData = new FormData(profileForm);
                  const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                  const saveButton = profileForm.querySelector('button[type="submit"]');
                  const buttonOriginalHTML = saveButton.innerHTML;

                  // Disable button and show loading state
                  saveButton.disabled = true;
                  saveButton.innerHTML = `<span class="truncate">Saving...</span>`;

                  fetch(window.location.href, {
                      method: 'POST',
                      body: formData,
                      headers: {
                          'X-CSRFToken': csrfToken,
                          'X-Requested-With': 'XMLHttpRequest' // To help backend identify AJAX request
                      }
                  })
                  .then(response => {
                      if (!response.ok) {
                          // Try to get error message from backend if available
                          return response.json().then(err => { throw err; });
                      }
                      return response.json();
                  })
                  .then(data => {
                      if (data.status === 'success' && data.profile_image_url) {
                          const profileImage = document.getElementById('profileImage');
                          if (profileImage) {
                              // Update image src. Add a timestamp to prevent caching issues.
                              profileImage.src = data.profile_image_url + '?' + new Date().getTime();
                          }
                          // Optionally, display a success message to the user
                          alert('Profile updated successfully!'); 
                      } else {
                          // Handle cases where status is not 'success' or URL is missing
                          alert(data.message || 'An error occurred while updating the profile.');
                      }
                  })
                  .catch(error => {
                      console.error('Error:', error);
                      alert('Failed to update profile. ' + (error.message || 'Please check the console for details.'));
                  })
                  .finally(() => {
                      // Restore button state
                      saveButton.disabled = false;
                      saveButton.innerHTML = buttonOriginalHTML;
                  });
              });
          }
      });
  </script>
  </body></html>