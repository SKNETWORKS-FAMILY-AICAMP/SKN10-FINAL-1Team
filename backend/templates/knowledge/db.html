<div class="p-8">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }
    </style>
    <div class="mx-auto max-w-4xl">
    <!-- íƒ­ ë²„íŠ¼ë“¤-->
    <div x-data="{loading : false}" class="flex w-full bg-gray-100 rounded-lg p-1">
        <button class="{% if db == 'postgre' %}flex-1 text-center py-2 rounded-lg bg-white text-gray-900 font-medium
            {% else %}flex-1 text-center py-2 rounded-lg text-gray-600 hover:bg-white hover:text-gray-900{% endif %}"
            onclick="location.href=`{% url 'knowledge:dashboard' 'db' %}?db=postgre`"
            @click="loading = true">Storage</button>

        <button class="{% if db == 'pinecone' %}flex-1 text-center py-2 rounded-lg bg-white text-gray-900 font-medium
            {% else %}flex-1 text-center py-2 rounded-lg text-gray-600 hover:bg-white hover:text-gray-900{% endif %}"
            onclick="location.href=`{% url 'knowledge:dashboard' 'db' %}?db=pinecone`"
            @click="loading = true">Vector DB</button>

        <button class="{% if db == 's3' %}flex-1 text-center py-2 rounded-lg bg-white text-gray-900 font-medium
            {% else %}flex-1 text-center py-2 rounded-lg text-gray-600 hover:bg-white hover:text-gray-900{% endif %}"
            onclick="location.href=`{% url 'knowledge:dashboard' 'db' %}?db=s3`"
            @click="loading = true">S3</button>
        
        <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
        <div x-show="loading" class="fixed inset-0 flex items-center justify-center bg-white bg-opacity-70 z-60">
        <svg class="animate-spin h-12 w-12 text-orange-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor"
            d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z">
        </path>
        </svg>
        </div>
    </div>
    
    {% if db == 'postgre' %}
        <section class="mt-6 mb-10 rounded-lg bg-white p-6 shadow-md border border-gray-200">
        <h3 class="text-[var(--text-primary)] text-2xl font-semibold leading-tight tracking-[-0.015em] mb-6">PostgreSQL ì •ë³´</h3>
        <div class="grid grid-cols-1 gap-x-8 gap-y-5 md:grid-cols-2">
        <div class="border-b border-[var(--border-color)] pb-4 md:border-none md:pb-0">
        <p class="text-[var(--text-secondary)] text-sm font-medium leading-normal mb-1">DB ì´ë¦„</p>
        <p class="text-[var(--text-primary)] text-base font-normal leading-normal">{{postgre_db.name}}</p>
        </div>
        <div class="border-b border-[var(--border-color)] pb-4 md:border-none md:pb-0">
        <p class="text-[var(--text-secondary)] text-sm font-medium leading-normal mb-1">DB í˜¸ìŠ¤íŠ¸</p>
        <p class="text-[var(--text-primary)] text-base font-normal leading-normal">{{postgre_db.host}}</p>
        </div>
        <div>
        <p class="text-[var(--text-secondary)] text-sm font-medium leading-normal mb-1">DB í¬íŠ¸</p>
        <p class="text-[var(--text-primary)] text-base font-normal leading-normal">{{postgre_db.port}}</p>
        </div>
        <div>
        <p class="text-[var(--text-secondary)] text-sm font-medium leading-normal mb-1">DB ì—”ì§„</p>
        <p class="text-[var(--text-primary)] text-base font-normal leading-normal">{{postgre_db.engine}}</p>
        </div>
        </div>
        </section>

        <section class="mt-6 mb-10 rounded-lg bg-white p-6 shadow-md border border-gray-200">
        <h3 class="text-[var(--text-primary)] text-2xl font-semibold leading-tight tracking-[-0.015em] mb-6">PostgreSQL í…Œì´ë¸”</h3>
        <div class="@container mt-6">
        <div class="overflow-x-auto rounded-lg border border-[var(--border-color)]">
        <!-- íƒ­ ë²„íŠ¼-->
         
        <!-- íƒ­ ë²„íŠ¼ ì¢…ë£Œ-->
        <table class="min-w-full divide-y divide-[var(--border-color)]">
        <thead class="bg-slate-50">
        <tr>
        <th class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-120 px-6 py-4 text-left text-xs font-semibold text-[var(--text-secondary)] uppercase tracking-wider" scope="col">
                                í…Œì´ë¸”ëª…
                                </th>
        <th class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-240 px-6 py-4 text-left text-xs font-semibold text-[var(--text-secondary)] uppercase tracking-wider" scope="col">
                                ì „ì²´ ë ˆì½”ë“œ ìˆ˜
                                </th>
        <th class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-480 px-6 py-4 text-left text-xs font-semibold text-[var(--text-secondary)] uppercase tracking-wider" scope="col">
                                í¬ê¸°
                                </th>
        <th class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-480 px-6 py-4 text-left text-xs font-semibold text-[var(--text-secondary)] uppercase tracking-wider" scope="col"></th>
        </tr>
        </thead>
        <tbody class="divide-y divide-[var(--border-color)] bg-white">
        {% for table in tables %}
            <tr>
            <td class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-120 whitespace-nowrap px-6 py-4 text-sm font-medium text-[var(--text-primary)]">{{table.name}}</td>
            <td class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-360 whitespace-nowrap px-6 py-4 text-sm text-[var(--text-secondary)]">{{table.count}}</td>
            <td class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-480 whitespace-nowrap px-6 py-4 text-sm text-[var(--text-secondary)]">{{table.size}}</td>
        </tr>
        {% endfor %}
        </tbody>
        </table>
        </div>
        <style>
                            @container(max-width:120px) {
                            .table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-120 {
                                display: none;
                            }
                            }
                            @container(max-width:240px) {
                            .table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-240 {
                                display: none;
                            }
                            }
                            @container(max-width:360px) {
                            .table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-360 {
                                display: none;
                            }
                            }
                            @container(max-width:480px) {
                            .table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-480 {
                                display: none;
                            }
                            }
                        </style>
        </div>
    {% endif %}

    {% if db == 'pinecone' %}
    <section x-data="{
        // í˜„ì¬ ì—´ë ¤ ìˆëŠ” ëª¨ë‹¬ êµ¬ë¶„: 'index_add' | 'index_delete' | index_detail | namespace_detail | null
        active : null,
        // ê³µí†µ ìƒíƒœ
        loading: false, error: '',
        // ëª¨ë‹¬ë³„ í¼ ë°ì´í„°
        index_add : {name : '' ,vector_type: 'dense', metric: 'cosine', dimension: null, cloud: 'aws', region: 'us-east-1'},
        index_del : { name: ''},
        namespaces: [],
        documents: [],
        regionMap: {
        aws:   ['us-east-1', 'us-west-2', 'eu-west-1'],
        gcp:   ['us-central1', 'europe-west4'],
        azure: ['eastus2']
        },
        indexName: '',
        namespaceName : '',
        // ëª¨ë‹¬ ì—´ê³  ë‹«ê¸°
        open(name) { this.active = name},
        close() { 
            this.active = null
            this.error = ''
        },

        // í•¨ìˆ˜ë“¤
        init() {
            this.index_add.region = this.regionMap[this.index_add.cloud][0]
        },
        submitDelete(event) {
            if (!this.index_del.name) {
                this.error = 'ì¸ë±ìŠ¤ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'
            }
            else {
                // í™•ì¸ì°½ ë„ìš°ê¸°
                if (confirm('âš ï¸ ì •ë§ í•´ë‹¹ ì¸ë±ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    this.loading = true
                    this.close()
                    this.$nextTick(() => event.target.submit())
                }   
            }
        },
        submitAdd(event) {
            if (!this.index_add.name) {
                this.error = 'ì¸ë±ìŠ¤ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'
            } else if (this.index_add.vector_type === 'dense' && (isNaN(this.index_add.dimension) || this.index_add.dimension < 1)) {
                this.error = 'ë²¡í„° íƒ€ì…ì´ denseì¼ë•Œ ì°¨ì›ì€ 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤! ì˜¬ë°”ë¥¸ ì°¨ì›ì„ ì…ë ¥í•˜ì„¸ìš”!'
            } else {
                // í™•ì¸ì°½ ë„ìš°ê¸°
                if (confirm('âš ï¸ ì •ë§ ì´ ì¸ë±ìŠ¤ë¥¼ ì¶”ê°€í• ê¹Œìš”?')) {
                    this.loading = true
                    this.close()
                    this.$nextTick(() => event.target.submit())
                }   
            }
        },
        showNamespaces(name) {
            this.indexName  = name;
            this.loading = true;
            fetch(`/knowledge/dashboard/index_detail/${name}/`)
            .then(res => res.json())
            .then(data => {
            this.namespaces = data.namespaces;
            this.loading = false;
            });
            
        },

    }"
    x-init="init()"
    class="mt-6 rounded-lg bg-white p-6 shadow-md border border-gray-200">
    <div class="flex items-center mb-6">
        <h3 class="text-[var(--text-primary)] text-2xl font-semibold leading-tight tracking-[-0.015em]">Pinecone DB ì¸ë±ìŠ¤</h3>
        <div class="flex items-center gap-4 ml-auto">

        <!-- ì¸ë±ìŠ¤ ì‚­ì œ Alpine ì»´í¬ë„ŒíŠ¸ ì‹œì‘ -->
        <div class="relative">
        <!-- 1) ì¸ë±ìŠ¤ ì‚­ì œ ë²„íŠ¼ -->
        <button
            type="button"
            @click="open('index_delete')"
            class="flex items-center gap-3 rounded-full px-6 py-1.5 bg-orange-400 hover:bg-orange-600 text-black"
        ><span class="material-icons-outlined font-bold">ì¸ë±ìŠ¤ ì‚­ì œ</span></button>

        <!-- 2) ì¸ë±ìŠ¤ ì‚­ì œ ëª¨ë‹¬ ë°•ìŠ¤ -->
        <div
            x-show="active === 'index_delete'"
            class="fixed inset-0 flex items-center justify-center z-50 p-4"
            x-cloak
        >
            <div class="bg-white rounded-lg shadow-lg w-full max-w-md">
            <div class="flex justify-between items-center px-6 py-4 border-b">
                <h2 class="text-lg font-semibold">ì¸ë±ìŠ¤ ì‚­ì œ</h2>
                <button @click="close()" class="text-xl leading-none">&times;</button>
            </div>

            <form
                action="{% url 'knowledge:delete_index' %}"
                method="post"
                class="px-6 py-4 space-y-4"
                @submit.prevent="submitDelete($event)">
                {% csrf_token %}

                <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
                <div x-show="error"
                class="flex items-start space-x-2 bg-red-50 border-l-4 border-red-600 text-red-700 p-3 rounded-md shadow-sm mt-2">
                <!-- ì‹¤ì œ ë©”ì‹œì§€ -->
                <span x-text="error" class="text-sm"></span>
                </div>

                <div>
                <label class="block text-sm font-medium"><span class="text-red-500">âš ï¸ ì‚­ì œí•  ì¸ë±ìŠ¤ ì´ë¦„</span>ì„ ì…ë ¥í•˜ì„¸ìš”!</label>
                <input name="name" x-model="index_del.name" class="mt-1 w-full border rounded px-3 py-2" />
                </div>

                <div class="text-right space-x-2">
                <button
                    type="button"
                    @click="close()"
                    class="px-4 py-2 rounded border hover:bg-gray-100"
                >ì·¨ì†Œ</button>

                <button
                    type="submit"
                    class="px-4 py-2 rounded bg-red-500 hover:bg-red-700 text-white"
                >ì‚­ì œ</button>
                </div>
                
            </form>
            </div>
        </div>
        </div>
        <!-- ì¸ë±ìŠ¤ ì‚­ì œ Alpine ì»´í¬ë„ŒíŠ¸ ë -->
        
        <!-- ì¸ë±ìŠ¤ ì¶”ê°€ Alpine ì»´í¬ë„ŒíŠ¸ ì‹œì‘ -->
        <div class="relative">
        <!-- 1) ì¸ë±ìŠ¤ ì¶”ê°€ ë²„íŠ¼ -->
        <button
            type="button"
            @click="open('index_add')"
            class="flex items-center gap-3 rounded-full px-6 py-1.5 bg-orange-400 hover:bg-orange-600 text-black"
        ><span class="material-icons-outlined font-bold">ì¸ë±ìŠ¤ ì¶”ê°€</span></button>

        <!-- 2) ì¸ë±ìŠ¤ ì¶”ê°€ ëª¨ë‹¬ ë°•ìŠ¤ -->
        <div x-show="active === 'index_add'" class="fixed inset-0 flex items-center justify-center z-50 p-4"
        x-cloak>
            <div class="bg-white rounded-lg shadow-lg w-full max-w-md">
            <div class="flex justify-between items-center px-6 py-4 border-b">
                <h2 class="text-lg font-semibold">ì¸ë±ìŠ¤ ì¶”ê°€</h2>
                <button @click="close()" class="text-xl leading-none">&times;</button>
            </div>

            <form
                action="{% url 'knowledge:create_index' %}"
                method="post"
                class="px-6 py-4 space-y-4"
                @submit.prevent="submitAdd($event)">
                {% csrf_token %}

                <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
                <div
                x-show="error"
                class="flex items-start space-x-2 bg-red-50 border-l-4 border-red-600 text-red-700 p-3 rounded-md shadow-sm mt-2"
                >
                <!-- ì‹¤ì œ ë©”ì‹œì§€ -->
                <span x-text="error" class="text-sm"></span>
                </div>

                <div>
                <label class="block text-sm font-medium">ì¸ë±ìŠ¤ ì´ë¦„</label>
                <input name="name" x-model="index_add.name" class="mt-1 w-full border rounded px-3 py-2" />
                </div>

                <div>
                <label class="block text-sm font-medium">ë²¡í„° íƒ€ì…</label>
                <!-- vector typeì´ sparseë¼ë©´ metricì€ dotproduct, dimensionì€ 0ìœ¼ë¡œ ì„ íƒë˜ì–´ ì „ë‹¬-->
                <select id="vector_type" name="vector_type" class="w-full border rounded p-2"
                    x-model="index_add.vector_type"
                    @change="
                    if (index_add.vector_type === 'sparse') {
                        index_add.metric = 'dotproduct';
                        index_add.dimension = 0;
                    }">
                    <option value="dense">dense</option>
                    <option value="sparse">sparse</option>
                </select>
                </div>

                <div>
                <label class="block text-sm font-medium">ê±°ë¦¬ í•¨ìˆ˜</label>
                <!-- vector_typeì´ sparseë©´ metricì€ dotproductë¡œ ê°’ ê³ ì • -->
                <select id="metric" name="metric" class="w-full border rounded p-2"
                    x-model="index_add.metric" 
                    :disabled="index_add.vector_type === 'sparse'">
                    <option value="cosine">cosine</option>
                    <option value="dotproduct">dotproduct</option>
                    <option value="euclidean">euclidean</option>
                </select>
                <!-- disabledë˜ë©´ ì›ë³¸ ê°’ì´ ì „ë‹¬ì´ ì•ˆë˜ë¯€ë¡œ hiddenìœ¼ë¡œ ì²˜ë¦¬-->
                <input type="hidden" name="metric" :value="index_add.metric"/>
                </div>

                <div>
                <label class="block text-sm font-medium">ì°¨ì› ìˆ˜</label>
                <!-- vector_typeì´ sparseë©´ dimensionì€ 0ë¡œ ê°’ ê³ ì • -->
                <input name="dimension" type="number" class="mt-1 w-full border rounded px-3 py-2"
                    x-model="index_add.dimension" 
                    :disabled="index_add.vector_type === 'sparse'"/>
                <!-- disabledë˜ë©´ ì›ë³¸ ê°’ì´ ì „ë‹¬ì´ ì•ˆë˜ë¯€ë¡œ hiddenìœ¼ë¡œ ì²˜ë¦¬-->
                <input type="hidden" name="dimension" :value="index_add.dimension"/>
                </div>
                
                <div>
                <label class="block text-sm font-medium">í´ë¼ìš°ë“œ</label>
                <select id="cloud" name="cloud" class="w-full border rounded p-2"
                    x-model="index_add.cloud"
                    @change="index_add.region = regionMap[index_add.cloud][0]">
                    <option value="aws">aws</option>
                    <option value="gcp">gcp</option>
                    <option value="azure">azure</option>
                </select>
                </div>

                <div>
                <label class="block text-sm font-medium">ì§€ì—­</label>
                <select id="region" name="region" class="w-full border rounded p-2"
                    x-model="index_add.region">
                    <template x-for="r in regionMap[index_add.cloud]" :key="r">
                        <option :value="r" x-text="r"></option>
                    </template>
                </select>
                </div>
                
                <!-- ì£¼ì˜ì‚¬í•­ -->
                <p class="text-red-500 text-sm italic mt-4">
                    âš ï¸ ì°¸ê³ : ë²¡í„° íƒ€ì…ìœ¼ë¡œ 'sparse' ì„ íƒ ì‹œ ê±°ë¦¬í•¨ìˆ˜ëŠ” 'dotproduct', ì°¨ì› ìˆ˜ëŠ” 0ìœ¼ë¡œ ê³ ì •ë©ë‹ˆë‹¤! <br><br>
                    âš ï¸ ì°¸ê³ : í´ë¼ìš°ë“œ ì„ íƒì— ë”°ë¼ ì„ íƒ ê°€ëŠ¥í•œ ì§€ì—­ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤!
                </p>

                <div class="text-right space-x-2">
                <button
                    type="button"
                    @click="close()"
                    class="px-4 py-2 rounded border hover:bg-gray-100"
                >ì·¨ì†Œ</button>
                <button
                    type="submit"
                    class="px-4 py-2 rounded bg-orange-400 hover:bg-orange-600 text-white"
                >ì¶”ê°€</button>
                </div>
                
            </form>
            </div>
        </div>
        </div>
        </div>
        <!-- ì¸ë±ìŠ¤ ì¶”ê°€ Alpine ì»´í¬ë„ŒíŠ¸ ë -->
        
    </div>
    <div class="@container">
    <div class="overflow-x-auto rounded-lg border border-[var(--border-color)]">
    <table class="min-w-full divide-y divide-[var(--border-color)]">
    <thead class="bg-slate-50">
    <tr>
    <th class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-120 px-6 py-4 text-left text-xs font-semibold text-[var(--text-secondary)] uppercase tracking-wider" scope="col">
                            ì¸ë±ìŠ¤ëª…
                            </th>
    <th class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-240 px-6 py-4 text-left text-xs font-semibold text-[var(--text-secondary)] uppercase tracking-wider" scope="col">
                            ì°¨ì› ìˆ˜
                            </th>
    <th class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-480 px-6 py-4 text-left text-xs font-semibold text-[var(--text-secondary)] uppercase tracking-wider" scope="col">
                            ì „ì²´ ë ˆì½”ë“œ ìˆ˜
                            </th>
    <th class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-480 px-6 py-4 text-left text-xs font-semibold text-[var(--text-secondary)] uppercase tracking-wider" scope="col">
                            ì§€ì—­
                            </th>
    <th class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-480 px-6 py-4 text-left text-xs font-semibold text-[var(--text-secondary)] uppercase tracking-wider" scope="col">
                            í´ë¼ìš°ë“œ
                            </th>
    </tr>
    </thead>
    <tbody class="divide-y divide-[var(--border-color)] bg-white">
    {% for index in indexes %}
        <tr>
        <td class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-120 whitespace-nowrap px-6 py-4 text-sm font-medium text-[var(--text-primary)]">
            <!-- í…ìŠ¤íŠ¸ ì»´í¬ë„ŒíŠ¸-->
            <a href="#"
            @click="open('index_detail')"
            @click.prevent="showNamespaces('{{ index.name }}')"
            class="text-blue-500 hover:text-blue-700 underline">{{index.name}}</a>
            
            <!-- ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ëª¨ë‹¬ -->
            <div x-show="active === 'index_detail'" class="fixed inset-0 flex items-center justify-center z-50 p-4" x-cloak>
            <div class="bg-white rounded-lg shadow-lg w-full max-w-xl max-h-[90vh] overflow-y-auto overflow-x-hidden p-6 ">
                <div class="flex justify-between items-center px-6 py-4 border-b">
                    <h2 class="text-lg font-semibold"><span class="text-red-500 mt-4" x-text="indexName"></span>ì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤</h2>
                    <button @click="close()" class="text-xl leading-none">&times;</button>
                </div>
            <div class="px-6 py-4">
                <template x-if="loading">
                    <p class="text-center text-gray-500">ë¡œë”© ì¤‘â€¦</p>
                </template>
                <p x-show="!loading" class="text-base mb-4 text-[var(--text-primary)]">
                    ì´ <span class="text-red-500 font-semibold" x-text="Object.keys(namespaces).length"></span>
                    ê°œì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ê°€ ìˆìŠµë‹ˆë‹¤.</p>
                
                <div class="overflow-x-auto rounded-lg border border-[var(--border-color)]">
                <table x-show="!loading" x-cloak class="min-w-full divide-y divide-[var(--border-color)]">
                    <thead class="bg-slate-50">
                        <tr>
                        <th class="px-6 py-4 text-left text-xs font-semibold">ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëª…</th>
                        <th class="px-6 py-4 text-left text-xs font-semibold">ë°ì´í„° ìˆ˜</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-[var(--border-color)] bg-white">
                        <template x-for="(count, name) in namespaces" :key="name">
                        <tr>
                            <td class="px-6 py-4 text-sm" >
                                <a href="#"
                                @click.prevent="
                                    close();
                                    let url = `/knowledge/dashboard/index_detail/${indexName}/${name}/`;
                                    window.open(url, '_blank');"
                                x-text="name"
                                class="text-blue-500 hover:text-blue-700 underline"></a>
                            </td>
                            <td class="px-6 py-4 text-sm" x-text="count"></td>
                        </tr>
                        </template>
                        <template x-if="!loading && Object.keys(namespaces).length === 0">
                        <tr>
                            <td colspan="2" class="px-6 py-4 text-center text-sm text-gray-500">
                            ë„¤ì„ìŠ¤í˜ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.
                            </td>
                        </tr>
                        </template>
                    </tbody>
                </table>
                </div>
            </div>
            </div>
            </div>

        </td>
        <td class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-360 whitespace-nowrap px-6 py-4 text-sm text-[var(--text-secondary)]">{{index.dimension}}</td>
        <td class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-480 whitespace-nowrap px-6 py-4 text-sm text-[var(--text-secondary)]">{{index.total_count}}</td>
        <td class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-480 whitespace-nowrap px-6 py-4 text-sm text-[var(--text-secondary)]">{{index.region}}</td>
        <td class="table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-480 whitespace-nowrap px-6 py-4 text-sm text-[var(--text-secondary)]">{{index.cloud}}</td>    
    </tr>
    {% endfor %}
    </tbody>
    </table>
    <style>
                        p.truncate {
                            overflow: hidden;
                            white-space: nowrap;
                            text-overflow: ellipsis;
                        }
                        @container(max-width:120px) {
                        .table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-120 {
                            display: none;
                        }
                        }
                        @container(max-width:240px) {
                        .table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-240 {
                            display: none;
                        }
                        }
                        @container(max-width:360px) {
                        .table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-360 {
                            display: none;
                        }
                        }
                        @container(max-width:480px) {
                        .table-1fe95620-04dc-4fb3-af13-df40c44c1ea2-column-480 {
                            display: none;
                        }
                        }
                    </style>
    </div>

    <!-- ê³µí†µ ë°±ê·¸ë¼ìš´ë“œ ì˜¤ë²„ë ˆì´ -->
    <div
        x-show="active"
        x-cloak
        class="fixed inset-0 bg-black bg-opacity-50 z-40"
        @click="close()"
    ></div>

    <!-- ê³µí†µ ë¡œë”©í™”ë©´ -->
    <div x-show="loading" class="fixed inset-0 flex items-center justify-center bg-white bg-opacity-70 z-60">
    <svg class="animate-spin h-12 w-12 text-orange-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
    <circle class="opacity-25" cx="12" cy="12" r="10" sroke="currentColor" stroke-width="4"></circle>
    <path class="opacity-75" fill="currentColor"
        d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z">
    </path>
    </svg>
    </div>
    </div>

    </section>
    {% endif %}

    
    {% if db == 's3' %}
        <section class="mt-6 mb-10 rounded-lg bg-white p-6 shadow-md border border-gray-200">
        <h3 class="text-[var(--text-primary)] text-2xl font-semibold leading-tight tracking-[-0.015em] mb-6">s3 ë²„í‚· íƒìƒ‰ê¸°</h3>

        <div class="overflow-x-auto rounded-lg border border-[var(--border-color)]">
        <table class="min-w-full divide-y divide-[var(--border-color)]">
        <thead class="bg-slate-50">
        <tr>
            <th class="px-4 py-2 text-left text-xs font-semibold text-[var(--text-secondary)] uppercase tracking-wider" scope="col">ì´ë¦„</th>
            <th class="px-4 py-2 text-left text-xs font-semibold text-[var(--text-secondary)] uppercase tracking-wider" scope="col">ìœ í˜•</th>
            <th class="px-4 py-2 text-left text-xs font-semibold text-[var(--text-secondary)] uppercase tracking-wider" scope="col">ë§ˆì§€ë§‰ ìˆ˜ì •</th>
        </tr>
        </thead>
        <tbody class="divide-y divide-[var(--border-color)] bg-white">
            {% for d in directory %}
                {% if d.type == "folder" %}
                        <tr class="text-sm">
                            <td class= "px-4 py-1 ">
                                <a href="{% url 'knowledge:dashboard' 'db' %}?db=s3&bucket={{ d.bucket }}&prefix={{ d.prefix }}">
                                    ğŸ“ <span class="text-blue-500 underline">{{ d.name }}</span>
                                </a>
                            </td>
                            <td class= "px-4 py-1">í´ë”</td>
                            <td class= "px-4 py-1">-</td>
                        </tr>
                {% else %}
                    <tr class="text-sm">
                    <td class="text-black-500 px-4 py-1">
                        <a href="{% url 'knowledge:s3_detail' bucket=d.bucket key=d.key %}?filename={{d.name}}"
                        target="_blank">
                        ğŸ“œ <span class="text-black-400 underline">{{ d.name }}</span>
                        </a>
                    </td>
                    <td class= "px-4 py-1">{{d.file_type}}</td>
                    <td class= "px-4 py-1">{{d.last_modified}}</td>
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>
        </section>
    {% endif %}

    <!-- ì„±ê³µ ë©”ì‹œì§€ ì¶œë ¥ ë˜ëŠ” ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥-->
    {% if messages %}
        {% for message in messages %}
            <script>alert("{{ message|escapejs }}");</script>
        {% endfor %}
    {% endif %}
    </div>
    </div>