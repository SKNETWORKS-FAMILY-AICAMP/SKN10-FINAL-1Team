<html><head>
    <meta charset="utf-8"/>
    <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
    <link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B600%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B600%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
    <title>Stitch Design</title>
    <link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style type="text/tailwindcss">
        :root {
        --primary-color: #0b80ee;
        --secondary-color: #f0f2f5;
        --text-primary: #111518;
        --text-secondary: #60768a;
        --border-color: #dbe1e6;
        }
        body {
            font-family: Inter, "Noto Sans", sans-serif;
        }
    </style>
    <!-- alpine.js 임포트 --> 
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }
    </style>
    <!-- alpine.js 임포트--> 
    </head>
    <body>
    
    <div class="relative flex size-full min-h-screen flex-col group/design-root overflow-x-hidden">
    <div id="header-placeholder"></div>
    <div class="flex h-full grow">
    <aside id="sidebar-dashboard" class="w-0 md:w-72 p-0 md:p-4 border-r border-[var(--border-color)] bg-slate-50 flex flex-col gap-0 md:gap-4 transition-all duration-300 ease-in-out overflow-y-auto max-h-[calc(100vh-4rem)] md:sticky md:top-16 hidden md:flex">
    <!-- Desktop Sidebar Header -->
    <div class="p-4 border-b border-[var(--border-color)] hidden md:flex items-center justify-between">
        <h1 class="text-[var(--text-primary)] text-xl font-semibold">관리자 메뉴</h1>
    </div>
    <!-- Mobile Sidebar Header -->
    <div class="p-4 border-b border-[var(--border-color)] flex md:hidden items-center justify-between">
        <h1 class="text-[var(--text-primary)] text-xl font-semibold">Menu</h1>
        <button class="p-1 rounded-md hover:bg-[var(--secondary-color)] text-[var(--text-secondary)]" id="close-sidebar-dashboard-mobile">
            <span class="material-icons-outlined">close</span>
        </button>
    </div>

    <div x-data="{loading : false}" class="flex flex-col gap-6 p-4 md:p-0">
    <nav class="flex flex-col gap-2">

    <a class="{% if screen_type == 'home' %}flex items-center gap-3 rounded-lg px-3 py-2.5 text-white bg-[var(--primary-color)] hover:bg-blue-600 transition-colors duration-150
            {% else %}flex items-center gap-3 rounded-lg px-3 py-2.5 text-[var(--text-primary)] hover:bg-[var(--secondary-color)] transition-colors duration-150{% endif %}"
            href="{% url 'knowledge:dashboard' 'home' %}  " @click="loading = true">
    <div class="text-[var(--text-primary)]" data-icon="House" data-size="24px" data-weight="regular">
    <svg fill="currentColor" height="24px" viewBox="0 0 256 256" width="24px" xmlns="http://www.w3.org/2000/svg">
    <path d="M218.83,103.77l-80-75.48a1.14,1.14,0,0,1-.11-.11,16,16,0,0,0-21.53,0l-.11.11L37.17,103.77A16,16,0,0,0,32,115.55V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V160h32v48a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V115.55A16,16,0,0,0,218.83,103.77ZM208,208H160V160a16,16,0,0,0-16-16H112a16,16,0,0,0-16,16v48H48V115.55l.11-.1L128,40l79.9,75.43.11.1Z"></path>
    </svg>
    </div>
    <p class="text-sm font-medium leading-normal">홈</p>
    </a>

    <a class="{% if screen_type == 'db' %}flex items-center gap-3 rounded-lg px-3 py-2.5 text-white bg-[var(--primary-color)] hover:bg-blue-600 transition-colors duration-150
            {% else %}flex items-center gap-3 rounded-lg px-3 py-2.5 text-[var(--text-primary)] hover:bg-[var(--secondary-color)] transition-colors duration-150{% endif %}" 
            href="{% url 'knowledge:dashboard' 'db' %}  " @click="loading = true">
    <div data-icon="Database" data-size="24px" data-weight="fill">
    <svg fill="currentColor" height="24px" viewBox="0 0 256 256" width="24px" xmlns="http://www.w3.org/2000/svg">
    <path d="M128,24C74.17,24,32,48.6,32,80v96c0,31.4,42.17,56,96,56s96-24.6,96-56V80C224,48.6,181.83,24,128,24Zm80,104c0,9.62-7.88,19.43-21.61,26.92C170.93,163.35,150.19,168,128,168s-42.93-4.65-58.39-13.08C55.88,147.43,48,137.62,48,128V111.36c17.06,15,46.23,24.64,80,24.64s62.94-9.68,80-24.64Zm-21.61,74.92C170.93,211.35,150.19,216,128,216s-42.93-4.65-58.39-13.08C55.88,195.43,48,185.62,48,176V159.36c17.06,15,46.23,24.64,80,24.64s62.94-9.68,80-24.64V176C208,185.62,200.12,195.43,186.39,202.92Z"></path>
    </svg>
    </div>
    <p class="text-sm font-medium leading-normal">DB 관리</p>
    </a>

    <a class="{% if screen_type == 'log' %}flex items-center gap-3 rounded-lg px-3 py-2.5 text-white bg-[var(--primary-color)] hover:bg-blue-600 transition-colors duration-150
            {% else %}flex items-center gap-3 rounded-lg px-3 py-2.5 text-[var(--text-primary)] hover:bg-[var(--secondary-color)] transition-colors duration-150{% endif %}" 
            href="{% url 'knowledge:dashboard' 'log' %} " @click="loading = true">
    <div class="text-[var(--text-primary)]" data-icon="ChatCircleDots" data-size="24px" data-weight="regular">
    <svg fill="currentColor" height="24px" viewBox="0 0 256 256" width="24px" xmlns="http://www.w3.org/2000/svg">
    <path d="M140,128a12,12,0,1,1-12-12A12,12,0,0,1,140,128ZM84,116a12,12,0,1,0,12,12A12,12,0,0,0,84,116Zm88,0a12,12,0,1,0,12,12A12,12,0,0,0,172,116Zm60,12A104,104,0,0,1,79.12,219.82L45.07,231.17a16,16,0,0,1-20.24-20.24l11.35-34.05A104,104,0,1,1,232,128Zm-16,0A88,88,0,1,0,51.81,172.06a8,8,0,0,1,.66,6.54L40,216,77.4,203.53a7.85,7.85,0,0,1,2.53-.42,8,8,0,0,1,4,1.08A88,88,0,0,0,216,128Z"></path>
    </svg>
    </div>
    <p class="text-sm font-medium leading-normal">채팅 로그</p>
    </a>

    <a class="{% if screen_type == 'user' %}flex items-center gap-3 rounded-lg px-3 py-2.5 text-white bg-[var(--primary-color)] hover:bg-blue-600 transition-colors duration-150
            {% else %}flex items-center gap-3 rounded-lg px-3 py-2.5 text-[var(--text-primary)] hover:bg-[var(--secondary-color)] transition-colors duration-150{% endif %}"
            href="{% url 'knowledge:dashboard' 'user' %}  " @click="loading = true">
    <div class="text-[var(--text-primary)]" data-icon="Users" data-size="24px" data-weight="regular">
    <svg fill="currentColor" height="24px" viewBox="0 0 256 256" width="24px" xmlns="http://www.w3.org/2000/svg">
    <path d="M117.25,157.92a60,60,0,1,0-66.5,0A95.83,95.83,0,0,0,3.53,195.63a8,8,0,1,0,13.4,8.74,80,80,0,0,1,134.14,0,8,8,0,0,0,13.4-8.74A95.83,95.83,0,0,0,117.25,157.92ZM40,108a44,44,0,1,1,44,44A44.05,44.05,0,0,1,40,108Zm210.14,98.7a8,8,0,0,1-11.07-2.33A79.83,79.83,0,0,0,172,168a8,8,0,0,1,0-16,44,44,0,1,0-16.34-84.87,8,8,0,1,1-5.94-14.85,60,60,0,0,1,55.53,105.64,95.83,95.83,0,0,1,47.22,37.71A8,8,0,0,1,250.14,206.7Z"></path>
    </svg>
    </div>
    <p class="text-sm font-medium leading-normal">사용자 관리</p>
    </a>
    
    </nav>
    <!-- 로딩 오버레이 -->
            <div x-show="loading" class="fixed inset-0 flex items-center justify-center bg-white bg-opacity-70 z-60">
            <svg class="animate-spin h-12 w-12 text-orange-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor"
                d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z">
            </path>
            </svg>
            </div>
    </div>
    </aside>
    <main class="flex flex-col w-full h-full overflow-y-auto bg-white">
    <!-- Original main content starts here, header was removed -->
    {% if screen_type == 'home' %}
        {% include 'knowledge/home.html' %}
    {% elif screen_type == 'db' %}
        {% include 'knowledge/db.html' %}
    {% elif screen_type == 'log' %}
        {% include 'knowledge/log.html' %}
    {% elif screen_type == 'user' %}
        {% include 'knowledge/user.html' %}
    {% endif %}

    </main>
    </div>
    </div>
    </div>
    <script>
        const sidebarDashboard = document.getElementById('sidebar-dashboard');
        const openSidebarDashboardMobileButton = document.getElementById('open-sidebar-dashboard-mobile');
        const closeSidebarDashboardMobileButton = document.getElementById('close-sidebar-dashboard-mobile');
        const toggleSidebarDashboardDesktopButton = document.getElementById('toggle-sidebar-dashboard-desktop');
        const mainContentDashboard = document.querySelector('main.flex-1');

        function openMobileSidebar() {
            sidebarDashboard.classList.remove('w-0', 'p-0', 'hidden');
            sidebarDashboard.classList.add('w-80', 'p-4', 'absolute', 'z-20', 'bg-slate-50', 'h-full', 'max-h-full', 'top-0', 'flex');
            sidebarDashboard.classList.remove('md:w-72', 'md:p-4', 'md:sticky', 'md:top-16', 'max-h-[calc(100vh-4rem)]', 'md:w-20', 'md:p-2');
            
            const mobileHeader = sidebarDashboard.querySelector('.flex.md\:hidden.items-center.justify-between'); 
            if (mobileHeader) mobileHeader.classList.remove('hidden');
            
            const contentDiv = sidebarDashboard.querySelector('.flex.flex-col.gap-6');
            if (contentDiv) {
                contentDiv.classList.remove('md:p-0', 'hidden');
                contentDiv.classList.add('p-4');
            }
            sidebarDashboard.querySelectorAll('nav a > p, nav div[data-icon]').forEach(item => item.classList.remove('md:hidden'));

            const overlay = document.createElement('div');
            overlay.classList.add('fixed', 'inset-0', 'bg-black/30', 'z-10', 'md:hidden');
            overlay.id = 'sidebar-overlay-dashboard';
            document.body.appendChild(overlay);
            overlay.addEventListener('click', closeMobileSidebar);
            document.body.style.overflow = 'hidden';
        }

        function closeMobileSidebar() {
            sidebarDashboard.classList.add('w-0', 'p-0', 'hidden');
            sidebarDashboard.classList.remove('w-80', 'p-4', 'absolute', 'z-20', 'bg-slate-50', 'h-full', 'max-h-full', 'top-0', 'flex');
            sidebarDashboard.classList.add('md:sticky', 'md:top-16', 'max-h-[calc(100vh-4rem)]');
            if (window.innerWidth >= 768) {
                sidebarDashboard.classList.add('md:w-72', 'md:p-4', 'md:flex');
                sidebarDashboard.classList.remove('md:w-20', 'md:p-2');
            } else {
                sidebarDashboard.classList.remove('md:flex');
            }

            const overlay = document.getElementById('sidebar-overlay-dashboard');
            if (overlay) {
                overlay.remove();
            }
            document.body.style.overflow = ''; 
        }

        function toggleDesktopSidebar() {
            const toggleIcon = toggleSidebarDashboardDesktopButton.querySelector('.material-icons-outlined');
            const sidebarNavItemsText = sidebarDashboard.querySelectorAll('nav a > p');
            const sidebarNavItemsIcons = sidebarDashboard.querySelectorAll('nav div[data-icon]');
            const desktopSidebarMainTitle = sidebarDashboard.querySelector('.hidden.md\:flex.items-center.justify-between > h1'); // The h1 next to the desktop toggle
            const sidebarItemsContainer = sidebarDashboard.querySelector('.flex.flex-col.gap-6'); // Container of nav links

            if (sidebarDashboard.classList.contains('md:w-72')) { // Expanded -> Collapse
                sidebarDashboard.classList.remove('md:w-72', 'md:p-4');
                sidebarDashboard.classList.add('md:w-20', 'md:p-2');
                if(mainContentDashboard) mainContentDashboard.classList.add('md:ml-[5rem]'); 
                if(mainContentDashboard) mainContentDashboard.classList.remove('md:ml-[18rem]');
                toggleIcon.textContent = 'menu';
                sidebarNavItemsText.forEach(item => item.classList.add('md:hidden'));
                if (desktopSidebarMainTitle) desktopSidebarMainTitle.classList.add('md:hidden');
                sidebarNavItemsIcons.forEach(iconContainer => {
                    const link = iconContainer.closest('a');
                    if(link) link.classList.add('md:justify-center');
                    if(link) link.classList.remove('md:gap-3');
                });
                if(sidebarItemsContainer) {
                    sidebarItemsContainer.classList.remove('p-4','md:gap-6');
                    sidebarItemsContainer.classList.add('md:p-0', 'md:gap-2');
                }
            } else { // Collapsed -> Expand
                sidebarDashboard.classList.add('md:w-72', 'md:p-4');
                sidebarDashboard.classList.remove('md:w-20', 'md:p-2');
                if(mainContentDashboard) mainContentDashboard.classList.remove('md:ml-[5rem]');
                if(mainContentDashboard) mainContentDashboard.classList.add('md:ml-[18rem]');
                toggleIcon.textContent = 'menu_open';
                sidebarNavItemsText.forEach(item => item.classList.remove('md:hidden'));
                if (desktopSidebarMainTitle) desktopSidebarMainTitle.classList.remove('md:hidden');
                sidebarNavItemsIcons.forEach(iconContainer => {
                    const link = iconContainer.closest('a');
                    if(link) link.classList.remove('md:justify-center');
                    if(link) link.classList.add('md:gap-3');
                });
                if(sidebarItemsContainer) {
                    sidebarItemsContainer.classList.add('p-4','md:gap-6');
                    sidebarItemsContainer.classList.remove('md:p-0', 'md:gap-2');
                }
            }
        }

        if (openSidebarDashboardMobileButton) {
            openSidebarDashboardMobileButton.addEventListener('click', openMobileSidebar);
        }
        if (closeSidebarDashboardMobileButton) {
            closeSidebarDashboardMobileButton.addEventListener('click', closeMobileSidebar);
        }
        if (toggleSidebarDashboardDesktopButton) {
            toggleSidebarDashboardDesktopButton.addEventListener('click', toggleDesktopSidebar);
        }
        
        function initializeSidebarState() {
            const isDesktop = window.innerWidth >= 768;
            if (isDesktop) {
                sidebarDashboard.classList.remove('w-0', 'p-0', 'hidden', 'absolute', 'z-20', 'bg-slate-50', 'h-full', 'max-h-full', 'top-0', 'flex');
                sidebarDashboard.classList.add('md:sticky', 'md:top-16', 'max-h-[calc(100vh-4rem)]', 'md:flex');
                
                const isCurrentlyCollapsed = sidebarDashboard.classList.contains('md:w-20');
                if (!isCurrentlyCollapsed) { 
                    sidebarDashboard.classList.add('md:w-72', 'md:p-4');
                    sidebarDashboard.classList.remove('md:w-20', 'md:p-2');
                    if(mainContentDashboard) mainContentDashboard.classList.add('md:ml-[18rem]');
                    if(mainContentDashboard) mainContentDashboard.classList.remove('md:ml-[5rem]');
                    if(toggleSidebarDashboardDesktopButton) toggleSidebarDashboardDesktopButton.querySelector('.material-icons-outlined').textContent = 'menu_open';
                    sidebarDashboard.querySelectorAll('nav a > p, .hidden.md\:flex.items-center.justify-between > h1').forEach(el => el.classList.remove('md:hidden'));
                    sidebarDashboard.querySelectorAll('nav div[data-icon]').forEach(iconContainer => { 
                        const link = iconContainer.closest('a'); 
                        if(link) link.classList.remove('md:justify-center'); 
                        if(link) link.classList.add('md:gap-3'); 
                    });
                    const itemsContainer = sidebarDashboard.querySelector('.flex.flex-col.gap-6');
                    if(itemsContainer) { itemsContainer.classList.add('p-4', 'md:gap-6'); itemsContainer.classList.remove('md:p-0', 'md:gap-2');}
                } else {
                    if(mainContentDashboard) mainContentDashboard.classList.add('md:ml-[5rem]');
                    if(mainContentDashboard) mainContentDashboard.classList.remove('md:ml-[18rem]');
                    if(toggleSidebarDashboardDesktopButton) toggleSidebarDashboardDesktopButton.querySelector('.material-icons-outlined').textContent = 'menu';
                }
            } else { // Mobile
                sidebarDashboard.classList.add('w-0', 'p-0', 'hidden');
                sidebarDashboard.classList.remove('md:w-72', 'md:p-4', 'md:sticky', 'md:top-16', 'md:flex', 'md:w-20', 'md:p-2', 'absolute', 'z-20', 'bg-slate-50', 'h-full', 'max-h-full', 'top-0', 'flex');
                if(mainContentDashboard) mainContentDashboard.classList.remove('md:ml-[18rem]', 'md:ml-[5rem]');
            }
        }
        
        initializeSidebarState();
        window.addEventListener('resize', initializeSidebarState);
        
    </script>
    <script>
        function loadHeader() {
            fetch('/_header.html') // Adjusted path for templates in subdirectories
                .then(response => response.text())
                .then(data => {
                    document.getElementById('header-placeholder').innerHTML = data;
                    const mobileSidebarToggle = document.getElementById('open-sidebar-mobile');
                    if (mobileSidebarToggle) {
                      mobileSidebarToggle.style.display = 'none';
                    }
                    // Set active link
                    const currentPage = window.location.pathname.split('/').pop().replace('.html', '');
                    const navLink = document.querySelector(`nav a[data-navlink='${currentPage || 'dashboard'}']`);
                    if (navLink) {
                        navLink.classList.add('text-[var(--text-primary)]', 'bg-[var(--secondary-color)]');
                        navLink.classList.remove('text-[var(--text-secondary)]');
                    }

                    // Re-attach event listener for mobile sidebar toggle
                    // The openMobileSidebar function is already defined in dashboard.html's main script block
                    const openSidebarMobileButton = document.getElementById('open-sidebar-mobile');
                    if (typeof openMobileSidebar === 'function' && openSidebarMobileButton) {
                         openSidebarMobileButton.addEventListener('click', openMobileSidebar);
                    } else {
                        console.warn('openMobileSidebar function not found or button missing after header load.');
                    }
                })
                .catch(error => console.error('Error loading header:', error));
        }
        document.addEventListener('DOMContentLoaded', loadHeader);
    </script>
    </body></html>
